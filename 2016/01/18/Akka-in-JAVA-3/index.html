<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Akka in JAVA(三) | 翔妖除魔的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Akka in JAVA(三)上两个部分讲了Akka的基本知识和常见的用法.接下来讲一讲Akka的远程调用以及集群的使用.因为在现在的项目中,基本上都是分布式的,单个的应用程序都快成为”熊猫”了.因此Akka的远程以及集群调用就是非常有必要的了.
Remote调用Akka-Remoting是采用了P2P(peer-to-peer)的通信方式设计的,也就是端对端的方式.特别是Akka-Remotin">
<meta property="og:type" content="article">
<meta property="og:title" content="Akka in JAVA(三)">
<meta property="og:url" content="http://sunxiang0918.github.io/2016/01/18/Akka-in-JAVA-3/index.html">
<meta property="og:site_name" content="翔妖除魔的个人博客">
<meta property="og:description" content="Akka in JAVA(三)上两个部分讲了Akka的基本知识和常见的用法.接下来讲一讲Akka的远程调用以及集群的使用.因为在现在的项目中,基本上都是分布式的,单个的应用程序都快成为”熊猫”了.因此Akka的远程以及集群调用就是非常有必要的了.
Remote调用Akka-Remoting是采用了P2P(peer-to-peer)的通信方式设计的,也就是端对端的方式.特别是Akka-Remotin">
<meta property="og:image" content="http://sunxiang0918.github.io/img/2016/01/18/1.png">
<meta property="og:image" content="http://sunxiang0918.github.io/img/2016/01/18/2.png">
<meta property="og:updated_time" content="2016-02-11T14:19:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Akka in JAVA(三)">
<meta name="twitter:description" content="Akka in JAVA(三)上两个部分讲了Akka的基本知识和常见的用法.接下来讲一讲Akka的远程调用以及集群的使用.因为在现在的项目中,基本上都是分布式的,单个的应用程序都快成为”熊猫”了.因此Akka的远程以及集群调用就是非常有必要的了.
Remote调用Akka-Remoting是采用了P2P(peer-to-peer)的通信方式设计的,也就是端对端的方式.特别是Akka-Remotin">
  
    <link rel="alternative" href="/atom.xml" title="翔妖除魔的个人博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?4dca9e623f7fdea5fb0b76cf874ec84f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://cn.gravatar.com/userimage/59576603/20a4c13c78880c762190780266641c8e.jpg?size=200" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">翔妖除魔</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="oschina" target="_blank" href="https://git.oschina.net/xycm" title="oschina">oschina</a>
					        
								<a class="github" target="_blank" href="https://github.com/sunxiang0918" title="github">github</a>
					        
								<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/shou-son" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="mailto:sunxiang0918@gmail.com" title="mail">mail</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/DB2/" style="font-size: 10px;">DB2</a> <a href="/tags/Docker/" style="font-size: 14.29px;">Docker</a> <a href="/tags/GIT/" style="font-size: 12.86px;">GIT</a> <a href="/tags/Hadoop/" style="font-size: 10px;">Hadoop</a> <a href="/tags/Hbase/" style="font-size: 10px;">Hbase</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hibernate/" style="font-size: 11.43px;">Hibernate</a> <a href="/tags/Hive/" style="font-size: 10px;">Hive</a> <a href="/tags/JAVA/" style="font-size: 20px;">JAVA</a> <a href="/tags/JBOSS/" style="font-size: 11.43px;">JBOSS</a> <a href="/tags/JVM/" style="font-size: 11.43px;">JVM</a> <a href="/tags/Kafka/" style="font-size: 11.43px;">Kafka</a> <a href="/tags/Linux/" style="font-size: 11.43px;">Linux</a> <a href="/tags/Lucene/" style="font-size: 14.29px;">Lucene</a> <a href="/tags/MAC/" style="font-size: 12.86px;">MAC</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/Neo4j/" style="font-size: 10px;">Neo4j</a> <a href="/tags/Nutch/" style="font-size: 10px;">Nutch</a> <a href="/tags/Solr/" style="font-size: 10px;">Solr</a> <a href="/tags/Swift/" style="font-size: 18.57px;">Swift</a> <a href="/tags/Zookeeper/" style="font-size: 11.43px;">Zookeeper</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/其他/" style="font-size: 11.43px;">其他</a> <a href="/tags/博客/" style="font-size: 10px;">博客</a> <a href="/tags/团队管理/" style="font-size: 10px;">团队管理</a> <a href="/tags/大数据/" style="font-size: 17.14px;">大数据</a> <a href="/tags/敏捷开发/" style="font-size: 10px;">敏捷开发</a> <a href="/tags/日志挖掘/" style="font-size: 10px;">日志挖掘</a> <a href="/tags/爬虫/" style="font-size: 10px;">爬虫</a> <a href="/tags/生活/" style="font-size: 10px;">生活</a> <a href="/tags/集群/" style="font-size: 15.71px;">集群</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://fedcuit.github.io">尔东的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://chensunhao.github.io">沉寂头颅的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">85后码农一枚,主攻JAVA,辅助Swift.对检索,大数据,软件架构,IOS有浓厚兴趣.苹果脑残粉...</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">翔妖除魔</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://cn.gravatar.com/userimage/59576603/20a4c13c78880c762190780266641c8e.jpg?size=200" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">翔妖除魔</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="oschina" target="_blank" href="https://git.oschina.net/xycm" title="oschina">oschina</a>
			        
						<a class="github" target="_blank" href="https://github.com/sunxiang0918" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/shou-son" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="mailto:sunxiang0918@gmail.com" title="mail">mail</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Akka-in-JAVA-3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/18/Akka-in-JAVA-3/" class="article-date">
  	<time datetime="2016-01-18T13:23:13.000Z" itemprop="datePublished">2016-01-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Akka in JAVA(三)
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVA/">JAVA</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
      
      
        <div id="toc" class="article-toc">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Akka_in_JAVA(三)"><span class="toc-number">1.</span> <span class="toc-text">Akka in JAVA(三)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Remote调用"><span class="toc-number">1.1.</span> <span class="toc-text">Remote调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#远程调用的准备"><span class="toc-number">1.1.1.</span> <span class="toc-text">远程调用的准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-number">1.1.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建远程Actor"><span class="toc-number">1.1.3.</span> <span class="toc-text">创建远程Actor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查找远程Actor"><span class="toc-number">1.1.4.</span> <span class="toc-text">查找远程Actor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#序列化"><span class="toc-number">1.1.5.</span> <span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#远程Actor的路由"><span class="toc-number">1.1.6.</span> <span class="toc-text">远程Actor的路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#远程事件"><span class="toc-number">1.1.7.</span> <span class="toc-text">远程事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo"><span class="toc-number">1.1.8.</span> <span class="toc-text">Demo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cluster调用"><span class="toc-number">1.2.</span> <span class="toc-text">Cluster调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理"><span class="toc-number">1.2.1.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#节点状态"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">节点状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#故障监控"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">故障监控</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#集群事件"><span class="toc-number">1.2.3.</span> <span class="toc-text">集群事件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#集群事件Demo"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">集群事件Demo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#集群实践"><span class="toc-number">1.2.4.</span> <span class="toc-text">集群实践</span></a></li></ol></li></ol></li></ol>
          <hr/>
        </div>
        
        
        <h1 id="Akka_in_JAVA(三)">Akka in JAVA(三)</h1><p>上两个部分讲了<code>Akka</code>的基本知识和常见的用法.接下来讲一讲<code>Akka</code>的远程调用以及集群的使用.因为在现在的项目中,基本上都是分布式的,单个的应用程序都快成为”熊猫”了.因此<code>Akka</code>的远程以及集群调用就是非常有必要的了.</p>
<h2 id="Remote调用">Remote调用</h2><p><code>Akka-Remoting</code>是采用了P2P(peer-to-peer)的通信方式设计的,也就是端对端的方式.特别是Akka-Remoting不能与网络地址转换和负载均衡一起的工作.<br>但是,由于<code>Akka</code>在设计的时候就考虑了远程调用以及分布式的情况.因此,<code>Akka-Remoting</code>在使用上就非常的简单,几乎等于是透明的,和本地调用几乎相同.除了传递的消息需要可序列化以及创建和查找Actor的时候路径稍有不同外,没有其他的区别了.</p>
<h3 id="远程调用的准备">远程调用的准备</h3><p>要在项目中使用<code>Akka-Remoting</code>非常的简单,只需要引入Maven中的<code>akka-remote</code>就可以了.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>akka-remote_2.11<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="配置">配置</h3><p>由于Akka几乎没有特别的为<code>Remoting</code>提供专门的API,区别仅仅在于配置.因此,接下来就是要修改项目中的akka的配置了:</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">WCMapReduceApp &#123;</span><br><span class="line"></span><br><span class="line">  akka &#123;</span><br><span class="line">    actor &#123;</span><br><span class="line">      <span class="variable">provider =</span> <span class="string">"akka.remote.RemoteActorRefProvider"</span></span><br><span class="line">    &#125;</span><br><span class="line">    remote &#123;</span><br><span class="line">      <span class="variable">enabled-transports =</span> [<span class="string">"akka.remote.netty.tcp"</span>]</span><br><span class="line">      netty.tcp &#123;</span><br><span class="line">        <span class="variable">hostname =</span> <span class="string">"127.0.0.1"</span></span><br><span class="line">        <span class="variable">port =</span> <span class="number">2552</span>		<span class="comment"># 0表示自动选择一个可用的</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们来看看这个配置和本地的有什么不同.<br>这个配置文件在<code>akka</code>的配置项中添加了一个<code>actor</code>配置项,并指定<code>provider</code>也就是Actor提供者为<code>akka.remote.RemoteActorRefProvider</code>,即远程Actor提供者.<br>然后定义了<code>remote</code>远程传输方式,使用<code>akka.remote.netty.tcp</code>即<code>netty</code>的方式提供服务,服务的IP和端口分别是<code>127.0.0.1</code>和<code>2552</code>,就这么简单.而由于是端对端的通信,因此客户端的配置和服务器端的是一样的.</p>
<p>以上只是远程调用的最小的配置,完整的可选配置如下:</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line"> </span><br><span class="line">  actor &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 序列化方式</span></span><br><span class="line">    serializers &#123;</span><br><span class="line">      <span class="variable">proto =</span> <span class="string">"akka.serialization.ProtobufSerializer"</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 发布远程Akka</span></span><br><span class="line">    deployment &#123;</span><br><span class="line"> </span><br><span class="line">      default &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># 手动指定Actor的远程地址</span></span><br><span class="line">        <span class="comment"># if this is set to a valid remote address, the named actor will be deployed</span></span><br><span class="line">        <span class="comment"># at that node e.g. "akka://sys@host:port"</span></span><br><span class="line">        <span class="variable">remote =</span> <span class="string">""</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># 目标</span></span><br><span class="line">        target &#123;</span><br><span class="line"> </span><br><span class="line">          <span class="comment"># A list of hostnames and ports for instantiating the children of a</span></span><br><span class="line">          <span class="comment"># non-direct router</span></span><br><span class="line">          <span class="comment">#   The format should be on "akka://sys@host:port", where:</span></span><br><span class="line">          <span class="comment">#    - sys is the remote actor system name</span></span><br><span class="line">          <span class="comment">#    - hostname can be either hostname or IP address the remote actor</span></span><br><span class="line">          <span class="comment">#      should connect to</span></span><br><span class="line">          <span class="comment">#    - port should be the port for the remote server on the other node</span></span><br><span class="line">          <span class="comment"># The number of actor instances to be spawned is still taken from the</span></span><br><span class="line">          <span class="comment"># nr-of-instances setting as for local routers; the instances will be</span></span><br><span class="line">          <span class="comment"># distributed round-robin among the given nodes.</span></span><br><span class="line">          <span class="variable">nodes =</span> []</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  remote &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 传输方式</span></span><br><span class="line">    <span class="comment"># Which implementation of akka.remote.RemoteTransport to use</span></span><br><span class="line">    <span class="comment"># default is a TCP-based remote transport based on Netty</span></span><br><span class="line">    <span class="variable">transport =</span> <span class="string">"akka.remote.netty.NettyRemoteTransport"</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 受信模式</span></span><br><span class="line">    <span class="comment"># Enable untrusted mode for full security of server managed actors, allows</span></span><br><span class="line">    <span class="comment"># untrusted clients to connect.</span></span><br><span class="line">    <span class="variable">untrusted-mode =</span> off</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 集群检测超时时间</span></span><br><span class="line">    <span class="comment"># Timeout for ACK of cluster operations, like checking actor out etc.</span></span><br><span class="line">    <span class="variable">remote-daemon-ack-timeout =</span> <span class="number">30</span>s</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 是否记录接收的消息</span></span><br><span class="line">    <span class="comment"># If this is "on", Akka will log all inbound messages at DEBUG level, if off then they are not logged</span></span><br><span class="line">    <span class="variable">log-received-messages =</span> off</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 是否记录发送的消息</span></span><br><span class="line">    <span class="comment"># If this is "on", Akka will log all outbound messages at DEBUG level, if off then they are not logged</span></span><br><span class="line">    <span class="variable">log-sent-messages =</span> off</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Each property is annotated with (I) or (O) or (I&amp;O), where I stands for “inbound” and O for “outbound” connections.</span></span><br><span class="line">    <span class="comment"># The NettyRemoteTransport always starts the server role to allow inbound connections, and it starts</span></span><br><span class="line">    <span class="comment"># active client connections whenever sending to a destination which is not yet connected; if configured</span></span><br><span class="line">    <span class="comment"># it reuses inbound connections for replies, which is called a passive client connection (i.e. from server</span></span><br><span class="line">    <span class="comment"># to client).</span></span><br><span class="line">    netty &#123;</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 延迟阻塞超时时间</span></span><br><span class="line">      <span class="comment"># (O) In case of increased latency / overflow how long should we wait (blocking the sender)</span></span><br><span class="line">      <span class="comment"># until we deem the send to be cancelled?</span></span><br><span class="line">      <span class="comment"># 0 means "never backoff", any positive number will indicate time to block at most.</span></span><br><span class="line">      <span class="variable">backoff-timeout =</span> <span class="number">0</span>ms</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 加密cookie</span></span><br><span class="line">      <span class="comment"># (I&amp;O) Generate your own with '$AKKA_HOME/scripts/generate_config_with_secure_cookie.sh'</span></span><br><span class="line">      <span class="comment"># or using 'akka.util.Crypt.generateSecureCookie'</span></span><br><span class="line">      <span class="variable">secure-cookie =</span> <span class="string">""</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 是否需要cookie</span></span><br><span class="line">      <span class="comment"># (I) Should the remote server require that its peers share the same secure-cookie</span></span><br><span class="line">      <span class="comment"># (defined in the 'remote' section)?</span></span><br><span class="line">      <span class="variable">require-cookie =</span> off</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 使用被动连接</span></span><br><span class="line">      <span class="comment"># (I) Reuse inbound connections for outbound messages</span></span><br><span class="line">      <span class="variable">use-passive-connections =</span> on</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 域名,连接地址</span></span><br><span class="line">      <span class="comment"># (I) The hostname or ip to bind the remoting to,</span></span><br><span class="line">      <span class="comment"># InetAddress.getLocalHost.getHostAddress is used if empty</span></span><br><span class="line">      <span class="variable">hostname =</span> <span class="string">""</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 端口</span></span><br><span class="line">      <span class="comment"># (I) The default remote server port clients should connect to.</span></span><br><span class="line">      <span class="comment"># Default is 2552 (AKKA), use 0 if you want a random available port</span></span><br><span class="line">      <span class="variable">port =</span> <span class="number">2552</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment"># </span></span><br><span class="line">      <span class="comment"># (O) The address of a local network interface (IP Address) to bind to when creating</span></span><br><span class="line">      <span class="comment"># outbound connections. Set to "" or "auto" for automatic selection of local address.</span></span><br><span class="line">      <span class="variable">outbound-local-address =</span> <span class="string">"auto"</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 消息帧大小</span></span><br><span class="line">      <span class="comment"># (I&amp;O) Increase this if you want to be able to send messages with large payloads</span></span><br><span class="line">      <span class="variable">message-frame-size =</span> <span class="number">1</span> MiB</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 超时时间</span></span><br><span class="line">      <span class="comment"># (O) Timeout duration</span></span><br><span class="line">      <span class="variable">connection-timeout =</span> <span class="number">120</span>s</span><br><span class="line"> </span><br><span class="line">      <span class="comment">#连接备份日志大小</span></span><br><span class="line">      <span class="comment"># (I) Sets the size of the connection backlog</span></span><br><span class="line">      <span class="variable">backlog =</span> <span class="number">4096</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 执行线程池存活时间</span></span><br><span class="line">      <span class="comment"># (I) Length in akka.time-unit how long core threads will be kept alive if idling</span></span><br><span class="line">      <span class="variable">execution-pool-keepalive =</span> <span class="number">60</span>s</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 执行线程池大小</span></span><br><span class="line">      <span class="comment"># (I) Size of the core pool of the remote execution unit</span></span><br><span class="line">      <span class="variable">execution-pool-size =</span> <span class="number">4</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">#最大通道内存大小</span></span><br><span class="line">      <span class="comment"># (I) Maximum channel size, 0 for off</span></span><br><span class="line">      <span class="variable">max-channel-memory-size =</span> <span class="number">0</span>b</span><br><span class="line"> </span><br><span class="line">      <span class="comment">#总计通道内存大小</span></span><br><span class="line">      <span class="comment"># (I) Maximum total size of all channels, 0 for off</span></span><br><span class="line">      <span class="variable">max-total-memory-size =</span> <span class="number">0</span>b</span><br><span class="line"> </span><br><span class="line">      <span class="comment">#重试时间间隔</span></span><br><span class="line">      <span class="comment"># (O) Time between reconnect attempts for active clients</span></span><br><span class="line">      <span class="variable">reconnect-delay =</span> <span class="number">5</span>s</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 读取超时时间</span></span><br><span class="line">      <span class="comment"># (O) Read inactivity period (lowest resolution is seconds)</span></span><br><span class="line">      <span class="comment"># after which active client connection is shutdown;</span></span><br><span class="line">      <span class="comment"># will be re-established in case of new communication requests.</span></span><br><span class="line">      <span class="comment"># A value of 0 will turn this feature off</span></span><br><span class="line">      <span class="variable">read-timeout =</span> <span class="number">0</span>s</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 写入超时时间</span></span><br><span class="line">      <span class="comment"># (O) Write inactivity period (lowest resolution is seconds)</span></span><br><span class="line">      <span class="comment"># after which a heartbeat is sent across the wire.</span></span><br><span class="line">      <span class="comment"># A value of 0 will turn this feature off</span></span><br><span class="line">      <span class="variable">write-timeout =</span> <span class="number">10</span>s</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 所有超时时间</span></span><br><span class="line">      <span class="comment"># (O) Inactivity period of both reads and writes (lowest resolution is seconds)</span></span><br><span class="line">      <span class="comment"># after which active client connection is shutdown;</span></span><br><span class="line">      <span class="comment"># will be re-established in case of new communication requests</span></span><br><span class="line">      <span class="comment"># A value of 0 will turn this feature off</span></span><br><span class="line">      <span class="variable">all-timeout =</span> <span class="number">0</span>s</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># 重连窗口时间</span></span><br><span class="line">      <span class="comment"># (O) Maximum time window that a client should try to reconnect for</span></span><br><span class="line">      <span class="variable">reconnection-time-window =</span> <span class="number">600</span>s</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># The dispatcher used for the system actor "network-event-sender"</span></span><br><span class="line">    network-event-sender-dispatcher &#123;</span><br><span class="line">      <span class="variable">executor =</span> thread-pool-executor</span><br><span class="line">      <span class="variable">type =</span> PinnedDispatcher</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建远程Actor">创建远程Actor</h3><p>通过上面的配置后,在程序里面创建远程的Actor就非常的简单了,基本上感觉不到是创建的远程Actor.</p>
<p>只需要在创建<code>ActorSystem</code>的时候使用上面所说的配置文件即可,接下来的就和本地的Actor没有任何的区别:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ActorSystem system = ActorSystem.create(<span class="string">"WCMapReduceApp"</span>, ConfigFactory.load(<span class="string">"application"</span>)</span><br><span class="line">                .getConfig(<span class="string">"WCMapReduceApp"</span>));</span><br></pre></td></tr></table></figure>
<p>通过这个<code>actorSystem</code>创建出来的Actor的路径会是这样的:<code>akka.tcp://WCMapReduceApp@127.0.0.1:2552/user/remoteActor</code>,即是一个远程的Actor.</p>
<p>当然,除了直接在服务器端创建服务外,还能在客户端远程的要求服务器端创建一个Actor,并保持引用.</p>
<p>要实现这样的功能,同样需要修改配置文件:</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">akka </span><span class="expression">&#123;</span><br><span class="line">  <span class="variable">actor</span> &#123;</span><br><span class="line">    <span class="variable">deployment</span> &#123;</span><br><span class="line">      <span class="end-block">/sampleActor </span>&#123;</span><br><span class="line">        <span class="variable">remote</span> = <span class="string">"akka.tcp://sampleActorSystem@127.0.0.1:2553"</span></span><br><span class="line">      &#125;</span><span class="xml"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个配置文件告诉akka,在创建一个<code>/sampleActor</code>的时候,即<code>system.actorOf()</code>.指定的actor并不会在本地创建,而是会请求远程的actorSystem创建这个actor.</p>
<h3 id="查找远程Actor">查找远程Actor</h3><p>当客户端发布了一个远程的Actor后,客户端就需要调用它.而向它发送消息的先决条件就是要找到这个Actor.</p>
<p>查询远程的Actor也非常的简单.每一个远程的Actor都会有一个它自己的Path.其格式是:<code>akka://&lt;actorsystemname&gt;@&lt;hostname&gt;:&lt;port&gt;/&lt;actor path&gt;</code>,比如上面所说的<code>akka.tcp://WCMapReduceApp@127.0.0.1:2552/user/remoteActor</code>.那么获取这个Actor的<code>ActorRef</code>,就是通过<code>actorFor</code>或<code>actorSelection</code>方法传入这个<code>ActorPath</code>即可.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ActorRef remoteActor = system.actorFor(<span class="string">"akka.tcp://WCMapReduceApp@127.0.0.1:2552/user/WCMapReduceActor"</span>);</span><br></pre></td></tr></table></figure>
<p>接下来的操作就和本地的Actor一模一样了.</p>
<h3 id="序列化">序列化</h3><p>既然是远程调用,那么就涉及到消息的序列化.Akka内置了集中序列化的方式,也提供了序列化的扩展,你可以使用内置的序列化方式,也可以自己实现一个.</p>
<p>要选择使用何种序列化,需要修改配置文件.在<code>akka</code>一节中配置<code>serializers</code>选项,指定序列化的实现类:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">akka</span> &#123;</span><br><span class="line">  <span class="title">actor</span> &#123;</span><br><span class="line">    <span class="title">serializers</span> &#123;</span><br><span class="line">      <span class="title">java</span> = <span class="string">"akka.serialization.JavaSerializer"</span> <span class="comment">#本地调用的默认方式</span></span><br><span class="line">      proto = <span class="string">"akka.remote.serialization.ProtobufSerializer"</span> <span class="comment">#远程调用的默认方式</span></span><br><span class="line">      myown = <span class="string">"cn.sunxiang0918.akka.demo5.CustomSerializer"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置好这个后,还可以绑定数据类型与序列化方式之间的映射:</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">akka</span> &#123;</span><br><span class="line">    actor &#123;</span><br><span class="line">      serialization-<span class="keyword">bindings </span>&#123;</span><br><span class="line">        <span class="string">"java.lang.String"</span> = java</span><br><span class="line">        <span class="string">"akka.docs.serialization.Customer"</span> = java</span><br><span class="line">        <span class="string">"com.google.protobuf.Message"</span> = proto</span><br><span class="line">        <span class="string">"akka.docs.serialization.MyOwnSerializable"</span> = myown</span><br><span class="line">        <span class="string">"java.lang.Boolean"</span> = myown</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>上面这段代码就指定了各种数据类型分别采用不同的序列化方式.</p>
<p>如果觉得Akka内置的序列化方式不满足你的要求,可以自定义一个序列化类(通常并不需要).<br>这个也比较的简单,需要自定义的序列化类继承自<code>JSerializer</code>类.然后实现其中的方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> akka.actor.*;</span><br><span class="line"><span class="keyword">import</span> akka.serialization.*;</span><br><span class="line"><span class="keyword">import</span> com.typesafe.config.*;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyOwnSerializer</span> <span class="keyword">extends</span> <span class="title">JSerializer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// This is whether "fromBinary" requires a "clazz" or not</span></span><br><span class="line">      <span class="annotation">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">includeManifest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// Pick a unique identifier for your Serializer,</span></span><br><span class="line">      <span class="comment">// you've got a couple of billions to choose from,</span></span><br><span class="line">      <span class="comment">// 0 - 16 is reserved by Akka itself</span></span><br><span class="line">      <span class="annotation">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">identifier</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1234567</span>;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// "toBinary" serializes the given object to an Array of Bytes</span></span><br><span class="line">      <span class="annotation">@Override</span> <span class="keyword">public</span> <span class="keyword">byte</span>[] toBinary(Object obj) &#123;</span><br><span class="line">        <span class="comment">//序列化方法</span></span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// "fromBinary" deserializes the given array,</span></span><br><span class="line">      <span class="comment">// using the type hint (if any, see "includeManifest" above)</span></span><br><span class="line">      <span class="annotation">@Override</span> <span class="function"><span class="keyword">public</span> Object <span class="title">fromBinaryJava</span><span class="params">(<span class="keyword">byte</span>[] bytes,</span><br><span class="line">                     Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//反序列化方法</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="远程Actor的路由">远程Actor的路由</h3><p>由于<code>Akka-remoting</code>是基于点对点的.因此,并不能很好的使用网络提供的负载均衡等功能.其实,要解决这个问题,我们可以使用<code>Akka</code>的路由功能.即在配置远程Actor的时候,增加<code>router</code>的参数.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">akka.actor.deployment &#123;</span><br><span class="line">  /parent/remotePool &#123;</span><br><span class="line">    router = round-robin-pool</span><br><span class="line">    nr-of-instances = <span class="number">10</span></span><br><span class="line">    target.nodes = [<span class="string">"akka.tcp://app@10.0.0.2:2552"</span>, <span class="string">"akka://app@10.0.0.3:2552"</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么当向这个<code>/parent/remotePool</code>发送消息的时候,会轮询的把消息分发到不同的远程服务上,从而实现了高可用和负载均衡.</p>
<h3 id="远程事件">远程事件</h3><p>同Akka的本地Actor的生命周期Hook相同,Akka为远程的Actor申明了很多的事件.我们可以监听这些远程调用中发生的事件,也可以订阅这些事件.只需要在<code>ActorSystem.eventStream</code>中为下面的事件增加注册监听器即可. 需要注意的是如果要订阅任意的远程事件,是订阅<code>RemotingLifecycleEvent</code>,如果只订阅涉及链接的生命周期,需要订阅<code>akka.remote.AssociationEvent</code>.</p>
<ul>
<li>DisassociatedEvent : 链接结束事件,这个事件包含了链接方向以及参与方的地址.</li>
<li>AssociatedEvent : 链接成功建立事件,这个事件包含了链接方向以及参与方的地址.</li>
<li>AssociationErrorEvent : 链接相关错误事件,这个事件包含了链接方向以及参与方的地址以及错误的原因.</li>
<li>RemotingListenEvent : 远程子系统准备好接受链接时的事件,这个事件包含了链接方向以及参与方的地址.</li>
<li>RemotingShutdownEvent :    远程子系统被关闭的事件</li>
<li>RemotingErrorEvent :     远程相关的所有错误</li>
</ul>
<h3 id="Demo">Demo</h3><p>这里举一个稍微复杂点的例子——单词计数.这个是Hadoop的入门的例子,我们使用Akka配合远程调用来实现一次. 功能是这样的,服务端提供了map/reduce方式的单词数量的计算功能,而服务端提供了文本内容的.<br>它大概的运行流程是这样的:<br><img src="/img/2016/01/18/1.png" alt=""></p>
<ol>
<li>首先客户端的FileReadActor从文本文件中读取文件.</li>
<li>然后通过ClientActor发送给远端的服务端.</li>
<li>服务端通过WCMapReduceActor接受客户端发送的消息,并发消息放入优先级MailBox</li>
<li>WCMapReduceActor把接收到的文本内容分发给MapActor做Map计算</li>
<li>Map计算把结果都发送给ReduceActor,做汇总reduce计算.</li>
<li>最后AggregateActor把计算的结果显示出来.</li>
</ol>
<p>我们先来看客户端:</p>
<p><strong>FileReadActor.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileReadActor</span> <span class="keyword">extends</span> <span class="title">UntypedActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Object message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="comment">/*如果消息是String类型的*/</span></span><br><span class="line">            String fileName = (String) message;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                BufferedReader reader = <span class="keyword">new</span> BufferedReader(</span><br><span class="line">                        <span class="keyword">new</span> InputStreamReader(Thread.currentThread().getContextClassLoader().getResource(fileName).openStream()));</span><br><span class="line">                String line;</span><br><span class="line">                <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">/*遍历,一行一个消息反馈给消息发送方*/</span></span><br><span class="line">                    getSender().tell(line,<span class="keyword">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"All lines send !"</span>);</span><br><span class="line">                <span class="comment">/*发送一个结束标识*/</span></span><br><span class="line">                getSender().tell(String.valueOf(<span class="string">"EOF"</span>),<span class="keyword">null</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException x) &#123;</span><br><span class="line">                System.err.format(<span class="string">"IOException: %s%n"</span>, x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unknown message ["</span> + message + <span class="string">"]"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过InputStreamReader把文本内容一行一个的发送给Sender.</p>
<p><strong>ClientActor.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientActor</span> <span class="keyword">extends</span> <span class="title">UntypedActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActorRef remoteServer = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> start;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * <span class="doctag">@param</span> inRemoteServer</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientActor</span><span class="params">(ActorRef inRemoteServer)</span> </span>&#123;</span><br><span class="line">        remoteServer = inRemoteServer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Object message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/*如果接收到的任务是String的,那么就直接发送给remoteServer这个Actor*/</span></span><br><span class="line">        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            String msg = (String) message;</span><br><span class="line">            <span class="keyword">if</span> (message.equals(<span class="string">"EOF"</span>))&#123;</span><br><span class="line">                <span class="comment">//这个的Sender设置为自己是为了接收聚合完成的消息</span></span><br><span class="line">                remoteServer.tell(msg, getSelf());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                remoteServer.tell(msg, <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (message <span class="keyword">instanceof</span> Boolean) &#123;</span><br><span class="line">            System.out.println(<span class="string">"聚合完成"</span>);</span><br><span class="line">            <span class="comment">//聚合完成后发送显示结果的消息</span></span><br><span class="line">            remoteServer.tell(<span class="string">"DISPLAY_LIST"</span>,<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//执行完毕,关机</span></span><br><span class="line">            getContext().stop(self());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*记录开始时间*/</span></span><br><span class="line">        start = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*计算用时*/</span></span><br><span class="line">        <span class="comment">// tell the world that the calculation is complete</span></span><br><span class="line">        <span class="keyword">long</span> timeSpent = (System.currentTimeMillis() - start);</span><br><span class="line">        System.out</span><br><span class="line">                .println(String</span><br><span class="line">                        .format(<span class="string">"\n\tClientActor estimate: \t\t\n\tCalculation time: \t%s MS"</span>,</span><br><span class="line">                                timeSpent));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个Actor重载了<code>preStart()</code>和<code>postStop()</code>方法用以记录性能.</p>
<p><strong>ClientMain.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//文件名</span></span><br><span class="line">        <span class="keyword">final</span> String fileName = <span class="string">"Othello.txt"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*根据配置,找到System*/</span></span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"ClientApplication"</span>, ConfigFactory.load(<span class="string">"client"</span>).getConfig(<span class="string">"WCMapReduceClientApp"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*实例化远程Actor*/</span></span><br><span class="line">        <span class="keyword">final</span> ActorRef remoteActor = system.actorFor(<span class="string">"akka.tcp://WCMapReduceApp@127.0.0.1:2552/user/WCMapReduceActor"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*实例化Actor的管道*/</span></span><br><span class="line">        <span class="keyword">final</span> ActorRef fileReadActor = system.actorOf(Props.create(FileReadActor.class));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*实例化Client的Actor管道*/</span></span><br><span class="line">        <span class="keyword">final</span> ActorRef clientActor = system.actorOf(Props.create(ClientActor.class,remoteActor));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*发送文件名给fileReadActor.设置sender或者说回调的Actor为clientActor*/</span></span><br><span class="line">        fileReadActor.tell(fileName,clientActor);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个类里面就使用了远程Actor的查找方法,通过<code>system.actorFor(&quot;akka.tcp://WCMapReduceApp@127.0.0.1:2552/user/WCMapReduceActor&quot;);</code>获取到了远程的Actor</p>
<p><strong>client.conf</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">WCMapReduceClientApp &#123;</span><br><span class="line">  include <span class="string">"common"</span></span><br><span class="line">  akka &#123;</span><br><span class="line">    actor &#123;</span><br><span class="line">      provider = <span class="string">"akka.remote.RemoteActorRefProvider"</span></span><br><span class="line">    &#125;</span><br><span class="line">    remote &#123;</span><br><span class="line">      enabled-transports = [<span class="string">"akka.remote.netty.tcp"</span>]</span><br><span class="line">      netty.tcp &#123;</span><br><span class="line">        hostname = <span class="string">"127.0.0.1"</span></span><br><span class="line">        port = <span class="number">2553</span>   <span class="comment">//0表示自动选择一个可用的</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来我们来看看服务器端:</p>
<p><strong>MyPriorityMailBox.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPriorityMailBox</span> <span class="keyword">extends</span> <span class="title">UnboundedPriorityMailbox</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 创建一个自定义优先级的无边界的邮箱. 用来规定命令的优先级. 这个就保证了DISPLAY_LIST 这个事件是最后再来处理.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyPriorityMailBox</span><span class="params">(ActorSystem.Settings settings, Config config)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Creating a new PriorityGenerator,</span></span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> PriorityGenerator() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">gen</span><span class="params">(Object message)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (message.equals(<span class="string">"DISPLAY_LIST"</span>))</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">2</span>; <span class="comment">// 'DisplayList messages should be treated</span></span><br><span class="line">                    <span class="comment">// last if possible</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (message.equals(PoisonPill.getInstance()))</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">3</span>; <span class="comment">// PoisonPill when no other left</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// By default they go with high priority</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过这个类,自定了一个无边界的优先级邮箱,这样做的目的是保证<code>DISPLAY_LIST</code>命令最后的响应.否则会出现文本内容还没有发送完成的情况下,就进行了结果的统计显示了.要使用这个自定义的优先级邮箱,需要在配置文件中进行配置:<br><strong>server.conf</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">WCMapReduceApp &#123;</span><br><span class="line">  include <span class="string">"common"</span></span><br><span class="line">  akka &#123;</span><br><span class="line">    actor &#123;</span><br><span class="line">      provider = <span class="string">"akka.remote.RemoteActorRefProvider"</span></span><br><span class="line">    &#125;</span><br><span class="line">    remote &#123;</span><br><span class="line">      enabled-transports = [<span class="string">"akka.remote.netty.tcp"</span>]</span><br><span class="line">      netty.tcp &#123;</span><br><span class="line">        hostname = <span class="string">"127.0.0.1"</span></span><br><span class="line">        port = <span class="number">2552</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  priorityMailBox-dispatcher &#123;</span><br><span class="line">    mailbox-type = <span class="string">"cn.sunxiang0918.akka.demo2.server.MyPriorityMailBox"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>MapActor.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapActor</span> <span class="keyword">extends</span> <span class="title">UntypedActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//停用词</span></span><br><span class="line">    String[] STOP_WORDS = &#123;<span class="string">"a"</span>, <span class="string">"about"</span>, <span class="string">"above"</span>, <span class="string">"above"</span>, <span class="string">"across"</span>, <span class="string">"after"</span>,</span><br><span class="line">            <span class="string">"afterwards"</span>, <span class="string">"again"</span>, <span class="string">"against"</span>, <span class="string">"all"</span>, <span class="string">"almost"</span>, <span class="string">"alone"</span>,</span><br><span class="line">            <span class="string">"along"</span>, <span class="string">"already"</span>, <span class="string">"also"</span>, <span class="string">"although"</span>, <span class="string">"always"</span>, <span class="string">"am"</span>, <span class="string">"among"</span>,</span><br><span class="line">            <span class="string">"amongst"</span>, <span class="string">"amoungst"</span>, <span class="string">"amount"</span>, <span class="string">"an"</span>, <span class="string">"and"</span>, <span class="string">"another"</span>, <span class="string">"any"</span>,</span><br><span class="line">            <span class="string">"anyhow"</span>, <span class="string">"anyone"</span>, <span class="string">"anything"</span>, <span class="string">"anyway"</span>, <span class="string">"anywhere"</span>, <span class="string">"are"</span>,</span><br><span class="line">            <span class="string">"around"</span>, <span class="string">"as"</span>, <span class="string">"at"</span>, <span class="string">"back"</span>, <span class="string">"be"</span>, <span class="string">"became"</span>, <span class="string">"because"</span>, <span class="string">"become"</span>,</span><br><span class="line">            <span class="string">"becomes"</span>, <span class="string">"becoming"</span>, <span class="string">"been"</span>, <span class="string">"before"</span>, <span class="string">"beforehand"</span>, <span class="string">"behind"</span>,</span><br><span class="line">            <span class="string">"being"</span>, <span class="string">"below"</span>, <span class="string">"beside"</span>, <span class="string">"besides"</span>, <span class="string">"between"</span>, <span class="string">"beyond"</span>, <span class="string">"bill"</span>,</span><br><span class="line">            <span class="string">"both"</span>, <span class="string">"bottom"</span>, <span class="string">"but"</span>, <span class="string">"by"</span>, <span class="string">"call"</span>, <span class="string">"can"</span>, <span class="string">"cannot"</span>, <span class="string">"cant"</span>,</span><br><span class="line">            <span class="string">"co"</span>, <span class="string">"con"</span>, <span class="string">"could"</span>, <span class="string">"couldnt"</span>, <span class="string">"cry"</span>, <span class="string">"de"</span>, <span class="string">"describe"</span>, <span class="string">"detail"</span>,</span><br><span class="line">            <span class="string">"do"</span>, <span class="string">"done"</span>, <span class="string">"down"</span>, <span class="string">"due"</span>, <span class="string">"during"</span>, <span class="string">"each"</span>, <span class="string">"eg"</span>, <span class="string">"eight"</span>,</span><br><span class="line">            <span class="string">"either"</span>, <span class="string">"eleven"</span>, <span class="string">"else"</span>, <span class="string">"elsewhere"</span>, <span class="string">"empty"</span>, <span class="string">"enough"</span>, <span class="string">"etc"</span>,</span><br><span class="line">            <span class="string">"even"</span>, <span class="string">"ever"</span>, <span class="string">"every"</span>, <span class="string">"everyone"</span>, <span class="string">"everything"</span>, <span class="string">"everywhere"</span>,</span><br><span class="line">            <span class="string">"except"</span>, <span class="string">"few"</span>, <span class="string">"fifteen"</span>, <span class="string">"fify"</span>, <span class="string">"fill"</span>, <span class="string">"find"</span>, <span class="string">"fire"</span>,</span><br><span class="line">            <span class="string">"first"</span>, <span class="string">"five"</span>, <span class="string">"for"</span>, <span class="string">"former"</span>, <span class="string">"formerly"</span>, <span class="string">"forty"</span>, <span class="string">"found"</span>,</span><br><span class="line">            <span class="string">"four"</span>, <span class="string">"from"</span>, <span class="string">"front"</span>, <span class="string">"full"</span>, <span class="string">"further"</span>, <span class="string">"get"</span>, <span class="string">"give"</span>, <span class="string">"go"</span>,</span><br><span class="line">            <span class="string">"had"</span>, <span class="string">"has"</span>, <span class="string">"hasnt"</span>, <span class="string">"have"</span>, <span class="string">"he"</span>, <span class="string">"hence"</span>, <span class="string">"her"</span>, <span class="string">"here"</span>,</span><br><span class="line">            <span class="string">"hereafter"</span>, <span class="string">"hereby"</span>, <span class="string">"herein"</span>, <span class="string">"hereupon"</span>, <span class="string">"hers"</span>, <span class="string">"herself"</span>,</span><br><span class="line">            <span class="string">"him"</span>, <span class="string">"himself"</span>, <span class="string">"his"</span>, <span class="string">"how"</span>, <span class="string">"however"</span>, <span class="string">"hundred"</span>, <span class="string">"ie"</span>, <span class="string">"if"</span>,</span><br><span class="line">            <span class="string">"in"</span>, <span class="string">"inc"</span>, <span class="string">"indeed"</span>, <span class="string">"interest"</span>, <span class="string">"into"</span>, <span class="string">"is"</span>, <span class="string">"it"</span>, <span class="string">"its"</span>,</span><br><span class="line">            <span class="string">"itself"</span>, <span class="string">"keep"</span>, <span class="string">"last"</span>, <span class="string">"latter"</span>, <span class="string">"latterly"</span>, <span class="string">"least"</span>, <span class="string">"less"</span>,</span><br><span class="line">            <span class="string">"ltd"</span>, <span class="string">"made"</span>, <span class="string">"many"</span>, <span class="string">"may"</span>, <span class="string">"me"</span>, <span class="string">"meanwhile"</span>, <span class="string">"might"</span>, <span class="string">"mill"</span>,</span><br><span class="line">            <span class="string">"mine"</span>, <span class="string">"more"</span>, <span class="string">"moreover"</span>, <span class="string">"most"</span>, <span class="string">"mostly"</span>, <span class="string">"move"</span>, <span class="string">"much"</span>,</span><br><span class="line">            <span class="string">"must"</span>, <span class="string">"my"</span>, <span class="string">"myself"</span>, <span class="string">"name"</span>, <span class="string">"namely"</span>, <span class="string">"neither"</span>, <span class="string">"never"</span>,</span><br><span class="line">            <span class="string">"nevertheless"</span>, <span class="string">"next"</span>, <span class="string">"nine"</span>, <span class="string">"no"</span>, <span class="string">"nobody"</span>, <span class="string">"none"</span>, <span class="string">"noone"</span>,</span><br><span class="line">            <span class="string">"nor"</span>, <span class="string">"not"</span>, <span class="string">"nothing"</span>, <span class="string">"now"</span>, <span class="string">"nowhere"</span>, <span class="string">"of"</span>, <span class="string">"off"</span>, <span class="string">"often"</span>,</span><br><span class="line">            <span class="string">"on"</span>, <span class="string">"once"</span>, <span class="string">"one"</span>, <span class="string">"only"</span>, <span class="string">"onto"</span>, <span class="string">"or"</span>, <span class="string">"other"</span>, <span class="string">"others"</span>,</span><br><span class="line">            <span class="string">"otherwise"</span>, <span class="string">"our"</span>, <span class="string">"ours"</span>, <span class="string">"ourselves"</span>, <span class="string">"out"</span>, <span class="string">"over"</span>, <span class="string">"own"</span>,</span><br><span class="line">            <span class="string">"part"</span>, <span class="string">"per"</span>, <span class="string">"perhaps"</span>, <span class="string">"please"</span>, <span class="string">"put"</span>, <span class="string">"rather"</span>, <span class="string">"re"</span>, <span class="string">"same"</span>,</span><br><span class="line">            <span class="string">"see"</span>, <span class="string">"seem"</span>, <span class="string">"seemed"</span>, <span class="string">"seeming"</span>, <span class="string">"seems"</span>, <span class="string">"serious"</span>, <span class="string">"several"</span>,</span><br><span class="line">            <span class="string">"she"</span>, <span class="string">"should"</span>, <span class="string">"show"</span>, <span class="string">"side"</span>, <span class="string">"since"</span>, <span class="string">"sincere"</span>, <span class="string">"six"</span>,</span><br><span class="line">            <span class="string">"sixty"</span>, <span class="string">"so"</span>, <span class="string">"some"</span>, <span class="string">"somehow"</span>, <span class="string">"someone"</span>, <span class="string">"something"</span>,</span><br><span class="line">            <span class="string">"sometime"</span>, <span class="string">"sometimes"</span>, <span class="string">"somewhere"</span>, <span class="string">"still"</span>, <span class="string">"such"</span>, <span class="string">"system"</span>,</span><br><span class="line">            <span class="string">"take"</span>, <span class="string">"ten"</span>, <span class="string">"than"</span>, <span class="string">"that"</span>, <span class="string">"the"</span>, <span class="string">"their"</span>, <span class="string">"them"</span>,</span><br><span class="line">            <span class="string">"themselves"</span>, <span class="string">"then"</span>, <span class="string">"thence"</span>, <span class="string">"there"</span>, <span class="string">"thereafter"</span>, <span class="string">"thereby"</span>,</span><br><span class="line">            <span class="string">"therefore"</span>, <span class="string">"therein"</span>, <span class="string">"thereupon"</span>, <span class="string">"these"</span>, <span class="string">"they"</span>, <span class="string">"thickv"</span>,</span><br><span class="line">            <span class="string">"thin"</span>, <span class="string">"third"</span>, <span class="string">"this"</span>, <span class="string">"those"</span>, <span class="string">"though"</span>, <span class="string">"three"</span>, <span class="string">"through"</span>,</span><br><span class="line">            <span class="string">"throughout"</span>, <span class="string">"thru"</span>, <span class="string">"thus"</span>, <span class="string">"to"</span>, <span class="string">"together"</span>, <span class="string">"too"</span>, <span class="string">"top"</span>,</span><br><span class="line">            <span class="string">"toward"</span>, <span class="string">"towards"</span>, <span class="string">"twelve"</span>, <span class="string">"twenty"</span>, <span class="string">"two"</span>, <span class="string">"un"</span>, <span class="string">"under"</span>,</span><br><span class="line">            <span class="string">"until"</span>, <span class="string">"up"</span>, <span class="string">"upon"</span>, <span class="string">"us"</span>, <span class="string">"very"</span>, <span class="string">"via"</span>, <span class="string">"was"</span>, <span class="string">"we"</span>, <span class="string">"well"</span>,</span><br><span class="line">            <span class="string">"were"</span>, <span class="string">"what"</span>, <span class="string">"whatever"</span>, <span class="string">"when"</span>, <span class="string">"whence"</span>, <span class="string">"whenever"</span>, <span class="string">"where"</span>,</span><br><span class="line">            <span class="string">"whereafter"</span>, <span class="string">"whereas"</span>, <span class="string">"whereby"</span>, <span class="string">"wherein"</span>, <span class="string">"whereupon"</span>,</span><br><span class="line">            <span class="string">"wherever"</span>, <span class="string">"whether"</span>, <span class="string">"which"</span>, <span class="string">"while"</span>, <span class="string">"whither"</span>, <span class="string">"who"</span>,</span><br><span class="line">            <span class="string">"whoever"</span>, <span class="string">"whole"</span>, <span class="string">"whom"</span>, <span class="string">"whose"</span>, <span class="string">"why"</span>, <span class="string">"will"</span>, <span class="string">"with"</span>,</span><br><span class="line">            <span class="string">"within"</span>, <span class="string">"without"</span>, <span class="string">"would"</span>, <span class="string">"yet"</span>, <span class="string">"you"</span>, <span class="string">"your"</span>, <span class="string">"yours"</span>,</span><br><span class="line">            <span class="string">"yourself"</span>, <span class="string">"yourselves"</span>, <span class="string">"the"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; STOP_WORDS_LIST = Arrays.asList(STOP_WORDS);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*reduce聚合的Actor*/</span></span><br><span class="line">    <span class="keyword">private</span> ActorRef actor = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapActor</span><span class="params">(ActorRef inReduceActor)</span> </span>&#123;</span><br><span class="line">        actor = inReduceActor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"启动MapActor:"</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 用于分词 计算单词的数量的</span><br><span class="line">     * <span class="doctag">@param</span> line</span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Result&gt; <span class="title">evaluateExpression</span><span class="params">(String line)</span> </span>&#123;</span><br><span class="line">        List&lt;Result&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">/*字符串分词器*/</span></span><br><span class="line">        StringTokenizer parser = <span class="keyword">new</span> StringTokenizer(line);</span><br><span class="line">        <span class="keyword">while</span> (parser.hasMoreTokens()) &#123;</span><br><span class="line">            <span class="comment">/*如果是,那么就判断是否是字母.然后把结果记录下来*/</span></span><br><span class="line">            String word = parser.nextToken().toLowerCase();</span><br><span class="line">            <span class="keyword">if</span> (isAlpha(word) &amp;&amp; !STOP_WORDS_LIST.contains(word)) &#123;</span><br><span class="line">                list.add(<span class="keyword">new</span> Result(word, <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 判断是否是字母</span><br><span class="line">     * <span class="doctag">@param</span> s</span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isAlpha</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        s = s.toUpperCase();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = (<span class="keyword">int</span>) s.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (c &lt; <span class="number">65</span> || c &gt; <span class="number">90</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Object message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            String work = (String) message;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (work.equals(<span class="string">"EOF"</span>))&#123;</span><br><span class="line">                <span class="comment">/*表示已经结束了*/</span></span><br><span class="line">                actor.tell(<span class="keyword">true</span>,<span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 计算这一行的单词情况</span></span><br><span class="line">            List&lt;Result&gt; list = evaluateExpression(work);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 把这一行的单词情况发送给汇总的ReduceActor</span></span><br><span class="line">            actor.tell(list, <span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unknown message ["</span> + message + <span class="string">"]"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当这个actor接收到消息后,判断是否是结束标识,如果是就发送消息给reduceActor表示已经结束了.否则就计算这一行中的单词的个数,并把这个个数发送给reduceActor.</p>
<p><strong>ReduceActor.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReduceActor</span> <span class="keyword">extends</span> <span class="title">UntypedActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*管道Actor*/</span></span><br><span class="line">    <span class="keyword">private</span> ActorRef actor = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReduceActor</span><span class="params">(ActorRef inAggregateActor)</span> </span>&#123;</span><br><span class="line">        actor = inAggregateActor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"启动ReduceActor:"</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Object message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> List) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*强制转换结果*/</span></span><br><span class="line">            List&lt;Result&gt; work = (List&lt;Result&gt;) message;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 第一次汇总单词表结果.</span></span><br><span class="line">            NavigableMap&lt;String, Integer&gt; reducedList = reduce(work);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 把这次汇总的结果发送给最终的结果聚合Actor</span></span><br><span class="line">            actor.tell(reducedList, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (message <span class="keyword">instanceof</span> Boolean) &#123;</span><br><span class="line">            <span class="comment">//表示已经计算结束了</span></span><br><span class="line">            <span class="comment">// 把这次汇总的结果发送给最终的结果聚合Actor</span></span><br><span class="line">            actor.tell(message, <span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unknown message ["</span> + message + <span class="string">"]"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 聚合计算本次结果中各个单词的出现次数</span><br><span class="line">     * <span class="doctag">@param</span> list</span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> NavigableMap&lt;String, Integer&gt; reduce(List&lt;Result&gt; list) &#123;</span><br><span class="line"></span><br><span class="line">        NavigableMap&lt;String, Integer&gt; reducedMap = <span class="keyword">new</span> ConcurrentSkipListMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Result result : list) &#123;</span><br><span class="line">            <span class="comment">/*遍历结果,如果在这个小的结果中已经存在相同的单词了,那么数量+1,否则新建*/</span></span><br><span class="line">            <span class="keyword">if</span> (reducedMap.containsKey(result.getWord())) &#123;</span><br><span class="line">                Integer value = reducedMap.get(result.getWord());</span><br><span class="line">                value++;</span><br><span class="line">                reducedMap.put(result.getWord(), value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                reducedMap.put(result.getWord(), <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> reducedMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个Actor接收到消息后,判断是什么消息,如果是结果消息,那么就对结果进行整理,得出某个单词出现的次数,否则就是结束标记,告诉管道Actor统计已经结束.</p>
<p><strong>AggregateActor.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AggregateActor</span> <span class="keyword">extends</span> <span class="title">UntypedActor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*最终的结果*/</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; finalReducedMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"启动AggregateActor:"</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Object message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/*如果是Map,那么就进行reduce操作*/</span></span><br><span class="line">        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> Map) &#123;</span><br><span class="line">            Map&lt;String, Integer&gt; reducedList = (Map&lt;String, Integer&gt;) message;</span><br><span class="line">            aggregateInMemoryReduce(reducedList);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="comment">/*如果是String,那么就是打印结果*/</span></span><br><span class="line">            <span class="keyword">if</span> (((String) message).compareTo(<span class="string">"DISPLAY_LIST"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//getSender().tell(finalReducedMap.toString());</span></span><br><span class="line">                System.out.println(finalReducedMap.toString());</span><br><span class="line">               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (message <span class="keyword">instanceof</span> Boolean) &#123;</span><br><span class="line">            <span class="comment">/*向客户端发送已经reduce完成的信息*/</span></span><br><span class="line">            getSender().tell(<span class="keyword">true</span>,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">aggregateInMemoryReduce</span><span class="params">(Map&lt;String, Integer&gt; reducedList)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String key : reducedList.keySet()) &#123;</span><br><span class="line">            <span class="comment">/*最终的数量的累加*/</span></span><br><span class="line">            <span class="keyword">if</span> (finalReducedMap.containsKey(key)) &#123;</span><br><span class="line">                Integer count = reducedList.get(key) + finalReducedMap.get(key);</span><br><span class="line">                finalReducedMap.put(key, count);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                finalReducedMap.put(key, reducedList.get(key));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个actor接收到消息后,判断消息的类型,如果是<code>DISPLAY_LIST</code>标识,那么就打印结果.如果是<code>Boolean</code>就表示统计完成了,那么就发送消息给客户端.如果是<code>Map</code>,那么这个就是某一个map/reduce的结果,那么就把这个结果聚合到最终的结果中去.</p>
<p><strong>WCMapReduceActor.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WCMapReduceActor</span> <span class="keyword">extends</span> <span class="title">UntypedActor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActorRef mapRouter;</span><br><span class="line">    <span class="keyword">private</span> ActorRef aggregateActor;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"启动WCMapReduceActor:"</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Object message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="comment">/*如果接收到的是显示结果的请求,那么就调用reduce的Actor*/</span></span><br><span class="line">            <span class="keyword">if</span> (((String) message).compareTo(<span class="string">"DISPLAY_LIST"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Got Display Message"</span>);</span><br><span class="line">                aggregateActor.tell(message, getSender());</span><br><span class="line">            &#125;<span class="keyword">if</span> (message.equals(<span class="string">"EOF"</span>))&#123;</span><br><span class="line">                <span class="comment">//表示发送完毕</span></span><br><span class="line">                aggregateActor.tell(<span class="keyword">true</span>, getSender());</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">/*否则给map的Actor进行计算*/</span></span><br><span class="line">                mapRouter.tell(message,<span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WCMapReduceActor</span><span class="params">(ActorRef inAggregateActor, ActorRef inMapRouter)</span> </span>&#123;</span><br><span class="line">        mapRouter = inMapRouter;</span><br><span class="line">        aggregateActor = inAggregateActor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>消息中转和统管的Actor,它统管了其他的几个Actor,是消息的入口.</p>
<p><strong>WCMapReduceServer.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WCMapReduceServer</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActorRef mapRouter;</span><br><span class="line">    <span class="keyword">private</span> ActorRef reduceRouter;</span><br><span class="line">    <span class="keyword">private</span> ActorRef aggregateActor;</span><br><span class="line">    <span class="keyword">private</span> ActorRef wcMapReduceActor;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WCMapReduceServer</span><span class="params">(<span class="keyword">int</span> no_of_reduce_workers, <span class="keyword">int</span> no_of_map_workers)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*创建了Actor系统*/</span></span><br><span class="line">        ActorSystem system = ActorSystem.create(<span class="string">"WCMapReduceApp"</span>, ConfigFactory.load(<span class="string">"application"</span>)</span><br><span class="line">                .getConfig(<span class="string">"WCMapReduceApp"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建聚合Actor</span></span><br><span class="line">        aggregateActor = system.actorOf(Props.create(AggregateActor.class));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建多个聚合的Actor</span></span><br><span class="line">        reduceRouter = system.actorOf(Props.create(ReduceActor.class,aggregateActor).withRouter(<span class="keyword">new</span> RoundRobinPool(no_of_reduce_workers)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建多个Map的Actor</span></span><br><span class="line">        mapRouter = system.actorOf(Props.create(MapActor.class,reduceRouter).withRouter(<span class="keyword">new</span> RoundRobinPool(no_of_map_workers)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create the overall WCMapReduce Actor that acts as the remote actor</span></span><br><span class="line">        <span class="comment">// for clients</span></span><br><span class="line">        Props props = Props.create(WCMapReduceActor.class,aggregateActor,mapRouter).withDispatcher(<span class="string">"priorityMailBox-dispatcher"</span>);</span><br><span class="line">        wcMapReduceActor = system.actorOf(props, <span class="string">"WCMapReduceActor"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * <span class="doctag">@param</span> args</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> WCMapReduceServer(<span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务端的入口程序,定义了一个50个actor的单词统计服务.并使用轮询模式来分发客服端接收到的统计任务.</p>
<p>以上就是整个DEMO的所有的代码.当执行这个程序后,会在控制台打印:</p>
<p>服务器端:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Got Display Message</span><br><span class="line">&#123;minerals=<span class="number">5</span>, half=<span class="number">35</span>, exceeding=<span class="number">5</span>, spoke=<span class="number">25</span>, mince=<span class="number">5</span>, hall=<span class="number">5</span>, disproportion=<span class="number">5</span>, youth=<span class="number">20</span>, guards=<span class="number">5</span>, wreck=<span class="number">5</span>, begins=<span class="number">10</span>, approved=<span class="number">20</span>, imperfect=<span class="number">5</span>, drunk=<span class="number">15</span>, framed=<span class="number">10</span>, pick=<span class="number">5</span>,......&#125;</span><br></pre></td></tr></table></figure>
<p>客户端:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">All lines send !</span><br><span class="line">聚合完成</span><br><span class="line">	ClientActor estimate: 		</span><br><span class="line">	Calculation time: 	<span class="number">467</span> MS</span><br></pre></td></tr></table></figure>
<p>到此,我们就实现了通过<code>AKKA-remoting</code> 来进行<code>map/reduce</code>的简单计算.</p>
<h2 id="Cluster调用">Cluster调用</h2><h3 id="原理">原理</h3><p>Akka除了remoting远程调用外,还提供了支持去中心化的基于P2P的集群服务,并且不会出现单点故障.Akka的集群是基于Gossip协议实现的,支持服务自动失效检测,能够自动发现出现问题而离开集群的成员节点,通过事件驱动的方式,将状态传播到整个集群的其他成员节点中去.Gossip协议是点对点通信协议的一种,它受社交网络中的流言传播的特点所启发,解决了在超大规模集群下其他方式无法解决的单点等问题.</p>
<p>一个Akka集群是由一组成员节点组成的,每一个成员节点都是通过<code>hostname:port:uid</code>来唯一标识,并且每一个成员节点间是完全解耦合的.</p>
<h4 id="节点状态">节点状态</h4><p>Akka集群内部为集群中的成员定义了6种状态,并提供了状态转换矩阵,这6种状态分别是:</p>
<ul>
<li>Joining : 正在加入集群的状态</li>
<li>Up :    正常提供服务的状态</li>
<li>Leaving :    正在离开集群的状态</li>
<li>Down :    节点服务下线的状态</li>
<li>Exiting :    节点离开状态</li>
<li>Removed :    节点被删除状态</li>
</ul>
<p><img src="/img/2016/01/18/2.png" alt=""></p>
<p>在Akka集群中的每一个成员节点,都只可能处在这6种状态中的一种中.当节点状态发生变化的时候,会发出节点状态事件.需要注意的是,除了Down和Removed状态外,其他状态是有可能随时变为Down状态的,即节点故障而无法提供服务.处于Down状态的节点如果想要再次加入Akka集群中,需要重新启动,并加入Joining状态,然后才能进行后续状态的变化,加入集群.</p>
<h4 id="故障监控">故障监控</h4><p>在Akka集群中,集群的每一个成员节点,都会被其他另外一组节点(默认是5个)所监控,这一组节点会通过心跳来检测被监控的节点是否处于Unreachable状态,如果不可达则这一组节点会将被监控的节点的Unreachable状态向集群中的其他所有节点传播,最终使集群中的每个成员节点都知道被监控的节点已经故障.</p>
<p>Akka集群中任一一个成员节点都有可能成为集群的Leader,这是基于Gossip协议收敛过程得到的确定性结果,并不是通过选举产生,从而避免了单点故障.在Akka集群中,Leader只是一种角色,在各轮Gossip收敛过程中Leader可能是不断变化的.Leader的职责就是让成员节点加入和离开集群.一个成员节点最开始是处于Joining状态,一旦所有其他节点都看到了新加入的该节点,则Leader会设置这个节点的状态为up.如果一个节点安全离开Akka集群,那么这个节点的状态会变为Leaving状态,当Leader看到该节点为Leaving状态,会将其状态修改为Exiting,然后通知所有其他节点,当所有节点看到该节点状态为exiting后,Leader将该节点移除,状态修改为removed状态.</p>
<h3 id="配置-1">配置</h3><p>要在项目中使用Akka集群,首先需要的就是在项目的Maven中引入akka-Cluster:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.typesafe.akka<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>akka-cluster_2.11<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在<code>application.conf</code>中配置必要的参数:</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  actor &#123;</span><br><span class="line">   <span class="comment">#表示Actor的提供者是Cluster集群</span></span><br><span class="line">    <span class="variable">provider =</span> <span class="string">"akka.cluster.ClusterActorRefProvider"</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#同akka-remoting,表示远程协议是什么</span></span><br><span class="line">  remote &#123;</span><br><span class="line">    <span class="variable">log-remote-lifecycle-events =</span> off</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      <span class="variable">hostname =</span> <span class="string">"127.0.0.1"</span></span><br><span class="line">      <span class="variable">port =</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#集群特有的配置</span></span><br><span class="line">  cluster &#123;</span><br><span class="line">    <span class="comment">#种子节点</span></span><br><span class="line">    <span class="variable">seed-nodes =</span> [</span><br><span class="line">      <span class="string">"akka.tcp://ClusterSystem@127.0.0.1:2551"</span>,</span><br><span class="line">      <span class="string">"akka.tcp://ClusterSystem@127.0.0.1:2552"</span>]</span><br><span class="line">    <span class="comment">#自动down掉不可达的成员节点</span></span><br><span class="line">    <span class="variable">auto-down-unreachable-after =</span> <span class="number">10</span>s</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的配置需要特别注意的就是<code>种子节点</code>,种子节点是akka集群中的一种特殊的节点角色.<br>种子节点最主要的用处是提供Cluster的初始化和加入点,同时也为其他节点作为中间联系人.要启动Akka-Cluster就必须配置一些列的种子节点.这些种子节点就是一开始就能够预料到的节点,有节点加入的时候,会等种子节点的返回确认才算是加入成功.</p>
<p>更多的集群配置请参见:<a href="http://doc.akka.io/docs/akka/snapshot/general/configuration.html#config-akka-cluster" target="_blank" rel="external">config-akka-cluster</a></p>
<h3 id="集群事件">集群事件</h3><p>正如上文所说,当节点发生变化的时候,Leader会发送状态的事件给集群中的所有成员节点.因此,接收和处理这些事件也是非常重要的.</p>
<ul>
<li>MemberUp : 成员节点上线</li>
<li>MemberExited : 成员节点下线</li>
<li>MemberRemoved : 成员节点被剔除</li>
<li>UnreachableMember : 成员节点无法到达</li>
<li>ReachableMember : 成员节点可到达</li>
<li>LeaderChanged : Leader变化</li>
<li>RoleLeaderChanged : 角色Leader变化</li>
<li>ClusterShuttingDown : 集群关闭</li>
<li>ClusterMetricsChanged : </li>
</ul>
<p>要说明这些节点的变化可以参考官方给出的最最简单的Akka集群的Demo,它不仅列出了一个最简单的Akka的集群要如何构建,也说明了这几个事件状态的变化.</p>
<h4 id="集群事件Demo">集群事件Demo</h4><p>在官方的文档中,编写了一个最简单的Akka-Cluster的例子,这个例子就是启动三个Akka的节点,并且监听了节点的所有事件,接收到事件后,打印出来.</p>
<p><strong>demo6.conf</strong></p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">akka &#123;</span><br><span class="line">  actor &#123;</span><br><span class="line">    <span class="variable">provider =</span> <span class="string">"akka.cluster.ClusterActorRefProvider"</span></span><br><span class="line">  &#125;</span><br><span class="line">  remote &#123;</span><br><span class="line">    <span class="variable">log-remote-lifecycle-events =</span> off</span><br><span class="line">    netty.tcp &#123;</span><br><span class="line">      <span class="variable">hostname =</span> <span class="string">"127.0.0.1"</span></span><br><span class="line">      <span class="variable">port =</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster &#123;</span><br><span class="line">    <span class="variable">seed-nodes =</span> [</span><br><span class="line">      <span class="comment">#先启动了两个种子节点,这样当有新的节点加入时,会把事件通知给这两个节点.</span></span><br><span class="line">      <span class="string">"akka.tcp://ClusterSystem@127.0.0.1:2551"</span>,</span><br><span class="line">      <span class="string">"akka.tcp://ClusterSystem@127.0.0.1:2552"</span>]</span><br><span class="line"></span><br><span class="line">    <span class="variable">auto-down-unreachable-after =</span> <span class="number">10</span>s</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>SimpleClusterListener.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleClusterListener</span> <span class="keyword">extends</span> <span class="title">UntypedActor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*记录日志*/</span></span><br><span class="line">    LoggingAdapter log = Logging.getLogger(getContext().system(), <span class="keyword">this</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*创建,获取集群*/</span></span><br><span class="line">    Cluster cluster = Cluster.get(getContext().system());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订阅集群中的事件</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//region subscribe</span></span><br><span class="line">        cluster.subscribe(getSelf(), ClusterEvent.initialStateAsEvents(),</span><br><span class="line">                MemberEvent.class, UnreachableMember.class);</span><br><span class="line">        <span class="comment">//endregion</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//re-subscribe when restart</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cluster.unsubscribe(getSelf());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Object message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*当接收到不同的事件的时候,打印出不同的信息*/</span></span><br><span class="line">        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> MemberUp) &#123;</span><br><span class="line">            MemberUp mUp = (MemberUp) message;</span><br><span class="line">            log.info(<span class="string">"Member is Up: &#123;&#125;"</span>, mUp.member());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message <span class="keyword">instanceof</span> UnreachableMember) &#123;</span><br><span class="line">            UnreachableMember mUnreachable = (UnreachableMember) message;</span><br><span class="line">            log.info(<span class="string">"Member detected as unreachable: &#123;&#125;"</span>, mUnreachable.member());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message <span class="keyword">instanceof</span> MemberRemoved) &#123;</span><br><span class="line">            MemberRemoved mRemoved = (MemberRemoved) message;</span><br><span class="line">            log.info(<span class="string">"Member is Removed: &#123;&#125;"</span>, mRemoved.member());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message <span class="keyword">instanceof</span> MemberEvent) &#123;</span><br><span class="line">            <span class="comment">// ignore</span></span><br><span class="line">            log.info(<span class="string">"Member Event: &#123;&#125;"</span>, ((MemberEvent) message).member());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            unhandled(message);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>SimpleClusterApp.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleClusterApp</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length == <span class="number">0</span>)</span><br><span class="line">            <span class="comment">/*启动三个节点*/</span></span><br><span class="line">            startup(<span class="keyword">new</span> String[]&#123;<span class="string">"2551"</span>, <span class="string">"2552"</span>, <span class="string">"0"</span>&#125;);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            startup(args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startup</span><span class="params">(String[] ports)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String port : ports) &#123;</span><br><span class="line">            <span class="comment">// 重写配置中的远程端口</span></span><br><span class="line">            Config config = ConfigFactory.parseString(</span><br><span class="line">                    <span class="string">"akka.remote.netty.tcp.port="</span> + port).withFallback(</span><br><span class="line">                    ConfigFactory.load(<span class="string">"demo6"</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建ActorSystem,名称需要和conf配置文件中的相同</span></span><br><span class="line">            ActorSystem system = ActorSystem.create(<span class="string">"ClusterSystem"</span>, config);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建集群中的Actor,并监听事件</span></span><br><span class="line">            system.actorOf(Props.create(SimpleClusterListener.class),</span><br><span class="line">                    <span class="string">"clusterListener"</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个简单的例子启动了三个节点,并创建了一个Actor来监听集群中的各种事件,执行这个Demo,会在控制台打印:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.051</span>] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.347</span>] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>]</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.356</span>] [main] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Starting up...</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.425</span>] [main] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Registered cluster JMX MBean [akka:<span class="built_in">type</span>=Cluster]</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.425</span>] [main] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Started up successfully</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.429</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">14</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Metrics will be retreived from MBeans, and may be incorrect on some platforms. To increase metric accuracy add the <span class="string">'sigar.jar'</span> to the classpath and the appropriate platform-specific native libary to <span class="string">'java.library.path'</span>. Reason: java.lang.ClassNotFoundException: org.hyperic.sigar.Sigar</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.432</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">14</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Metrics collection has started successfully</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.454</span>] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.460</span>] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>]</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.461</span>] [main] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>] - Starting up...</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.464</span>] [main] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>] - Started up successfully</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.464</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">4</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>] - Metrics will be retreived from MBeans, and may be incorrect on some platforms. To increase metric accuracy add the <span class="string">'sigar.jar'</span> to the classpath and the appropriate platform-specific native libary to <span class="string">'java.library.path'</span>. Reason: java.lang.ClassNotFoundException: org.hyperic.sigar.Sigar</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.464</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">4</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>] - Metrics collection has started successfully</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.486</span>] [main] [akka.remote.Remoting] Starting remoting</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.491</span>] [main] [akka.remote.Remoting] Remoting started; listening on addresses :[akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>]</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.492</span>] [main] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>] - Starting up...</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.494</span>] [main] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>] - Started up successfully</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.494</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">3</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>] - Metrics will be retreived from MBeans, and may be incorrect on some platforms. To increase metric accuracy add the <span class="string">'sigar.jar'</span> to the classpath and the appropriate platform-specific native libary to <span class="string">'java.library.path'</span>. Reason: java.lang.ClassNotFoundException: org.hyperic.sigar.Sigar</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.494</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">3</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>] - Metrics collection has started successfully</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.645</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">4</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] is JOINING, roles []</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.665</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">4</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Leader is moving node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] to [Up]</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">42.672</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">16</span>] [akka://ClusterSystem/user/clusterListener] Member is Up: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>, status = Up)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.662</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">3</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>] is JOINING, roles []</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.662</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">3</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>] is JOINING, roles []</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.665</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">18</span>] [akka://ClusterSystem/user/clusterListener] Member Event: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>, status = Joining)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.666</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">4</span>] [akka://ClusterSystem/user/clusterListener] Member Event: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>, status = Joining)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.731</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">21</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>] - Welcome from [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>]</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.731</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">17</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>] - Welcome from [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>]</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.731</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">2</span>] [akka://ClusterSystem/user/clusterListener] Member is Up: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>, status = Up)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.732</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">2</span>] [akka://ClusterSystem/user/clusterListener] Member Event: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>, status = Joining)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.732</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">2</span>] [akka://ClusterSystem/user/clusterListener] Member Event: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>, status = Joining)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.733</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">5</span>] [akka://ClusterSystem/user/clusterListener] Member is Up: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>, status = Up)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.733</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">5</span>] [akka://ClusterSystem/user/clusterListener] Member Event: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>, status = Joining)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">47.745</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">18</span>] [akka://ClusterSystem/user/clusterListener] Member Event: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>, status = Joining)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">48.464</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">15</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Leader is moving node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>] to [Up]</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">48.464</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">15</span>] [akka.cluster.Cluster(akka://ClusterSystem)] Cluster Node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2551</span>] - Leader is moving node [akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>] to [Up]</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">48.465</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">15</span>] [akka://ClusterSystem/user/clusterListener] Member is Up: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>, status = Up)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">48.465</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">15</span>] [akka://ClusterSystem/user/clusterListener] Member is Up: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>, status = Up)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">49.463</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">16</span>] [akka://ClusterSystem/user/clusterListener] Member is Up: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>, status = Up)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">49.463</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">16</span>] [akka://ClusterSystem/user/clusterListener] Member is Up: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>, status = Up)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">49.481</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">21</span>] [akka://ClusterSystem/user/clusterListener] Member is Up: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2552</span>, status = Up)</span><br><span class="line">[INFO] [<span class="number">02</span>/<span class="number">11</span>/<span class="number">2016</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">49.481</span>] [ClusterSystem-akka.actor.default-dispatcher-<span class="number">21</span>] [akka://ClusterSystem/user/clusterListener] Member is Up: Member(address = akka.tcp://ClusterSystem@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">57726</span>, status = Up)</span><br></pre></td></tr></table></figure>
<p>从日志中就可以看出各种状态的变化</p>
<h3 id="集群实践">集群实践</h3>
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/01/20/超越继承之路：协议混合/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          &lt;转&gt;超越继承之路：协议混合
        
      </div>
    </a>
  
  
    <a href="/2016/01/13/Akka-in-JAVA-2/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Akka in JAVA(二)</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Akka-in-JAVA-3" data-title="Akka in JAVA(三)" data-url="http://sunxiang0918.github.io/2016/01/18/Akka-in-JAVA-3/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"xycm"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 翔妖除魔
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>
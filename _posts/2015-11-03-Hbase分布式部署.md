---
title: Hbase分布式部署
date: 2015-11-03 23:12:39
tags:
- 大数据
- Hbase
- 集群
---

# Hbase分布式部署

HBase的安装首先是有两个先决条件的,第一个就是需要zookeeper的支持,另外一个就是需要HDFS的支持了.
因此,安装Hbase的头两部就是安装`zookeeper`和`hadoop`

这两个东西的安装可以参考我以前的博文:[Hadoop全分布式部署](http://sunxiang0918.cn/2015/11/03/Hadoop全分布式部署/)以及[zookeeper 集群部署](http://sunxiang0918.cn/2014/09/20/zookeeper-集群部署/).这里就不再复述了.

## 环境
环境: centos7 + hadoop2.6.2 + hbase1.1.2

虚拟机三台:

|hostname|ip地址|
|:--:|:--:|
|master	|10.211.55.15|
|slave01	|10.211.55.12|
|slave02	|10.211.55.14|

## 安装步骤

1. 首先还是需要把`hbase-1.1.2-bin.tar.gz`拷贝到几台机器上.然后使用`tar -xvf`命令解压,并重命名为hbase.  当前路径也就是 `/home/hadoop/hbase`

<!--more-->

2. 配置`conf/hbase-site.xml`
	
	```xml
	<?xml version="1.0"?>  
	<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>  
<configuration>  
  <property>  
    <name>hbase.rootdir</name>  
    <value>hdfs://master:9000/hbase</value>      
    <description>区域服务器使用存储HBase数据库数据的目录,服务器名称不能填IP，不然会报错</description>          
  </property>              
  <property>                
     <name>hbase.cluster.distributed</name>                 
     <value>true</value>                     
     <description>指定HBase运行的模式： false: 单机模式或者为分布式模式   true: 全分布模式 </description>             
  </property>                                                   
  <property>                                                     
    <name>hbase.zookeeper.quorum</name>                                                       
    <value> master,slave01, slave02 </value>                                                           
    <description>ZooKeeper集群服务器的位置</description>                                                                 
  </property>                                                                  
</configuration>
	```
	完整的配置可以看[此处](http://hbase.apache.org/book.html#config.files)

3. 配置数据服务器的地址
	也就是修改`/conf/regionservers`,把三台机器的host都写进去
	
	```bash
	master
	slave01
	slave02
	```

4. 配置HBase的JDK
	修改`/conf/hbase-env.sh`文件.
	打开注释 `export JAVA_HOME=xxxxxxx` 这里指向JDK的目录,要求是JDK1.7+
	
5. 配置ZK的使用方式.默认情况下是使用的hbase内置的ZK,这个在集群下是不行的.因此我们需要给他改成使用外部的集群的ZK.
	修改`/conf/hbase-env.sh`文件最后面.
	打开注释 `export HBASE_MANAGES_ZK=false` 这里的false指的就是使用外部的Zookeeper
	
6. 所有其他的机器都这样配置

7. 在主节点上 启动,验证
	配置好上面的这些东西后,就可以在主节点上启动hbase了.
	直接在`bin`中 输入 `./start-hbase.sh` 即可启动.
	
	```bash
	starting master, logging to /home/hadoop/hbase/bin/../logs/hbase-hadoop-master-master.out
slave01: starting regionserver, logging to /home/hadoop/hbase/bin/../logs/hbase-hadoop-regionserver-slave01.out
slave02: starting regionserver, logging to /home/hadoop/hbase/bin/../logs/hbase-hadoop-regionserver-slave02.out
master: starting regionserver, logging to /home/hadoop/hbase/bin/../logs/hbase-hadoop-regionserver-master.out
	```
	出现上面的东西 就说明是启动完成了.
	这个时候使用`jps`命令 应该可以看到有一个 `HMaster` 和 `HRegionServer` 服务.
	而在其他的从节点上 应该看得到`HRegionServer`服务.
	
	这个时候随便在某一台机器上输入 `./hbase shell` 进入hbase的终端,并输入`status`的话,应该可以看到集群的状态:
	
	```bash
	[hadoop@master bin]$ ./hbase shell
2015-11-03 23:02:05,690 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
HBase Shell; enter 'help<RETURN>' for list of supported commands.
Type "exit<RETURN>" to leave the HBase Shell
Version 1.1.2, rcc2b70cf03e3378800661ec5cab11eb43fafe0fc, Wed Aug 26 20:11:27 PDT 2015
hbase(main):001:0> status
3 servers, 0 dead, 0.6667 average load
	```
	
	同时也可以通过在浏览器中输入: `http://master:16010` 打开`HBase`的管理页面.也是可以的

到此,最简单的HBASE集群就搭建成功了.

